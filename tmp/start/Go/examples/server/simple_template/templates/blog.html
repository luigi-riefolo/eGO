<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
<head>
  <meta name="generator" content=
  "HTML Tidy for Mac OS X (vers 31 October 2006 - Apple Inc. build 15.17), see www.w3.org">

  <title>{{.Title}}</title>
</head>

<body>
  <script type="text/javascript">
   function putComment(el) {
           var id = $(el).find('.edit_id');
           var name = $(el).find('.edit_name').val();
           var email = $(el).find('.edit_email').val();
           var text = $(el).find('.edit_comments').val();
           $.ajax({
               url: '/api/comments/' + id,
               type: 'PUT',
               succes: function(res) {
                   alert('Comment Updated!');
               }
  });
        return false;
    }
  </script>

  <h1>{{.Title}}</h1>

  <p>{{.Content}}</p>

  <div>
    {{.Date}}
  </div>
  {{if .Session.Unauthenticated}}
  <form action="/register" method="post">
    <div>
      <input type="text" name="user_name" placeholder="User name">
    </div>

    <div>
      <input type="email" name="user_email" placeholder="Your email">
    </div>

    <div>
      <input type="password" name="user_password" placeholder="Password">
    </div>

    <div>
      <input type="password" name="user_password2" placeholder="Password (repeat)">
    </div>

    <div>
      <input type="submit" value="Register">
    </div>
  </form>
  {{end}}

  <div id="comments">
    <form action="/api/comments" method="post">
      <input type="hidden" name="id" value="{{.ID}}">

      <div>
        <input type="text" name="name" placeholder="Your Name">
      </div>

      <div>
        <input type="email" name="email" placeholder="Your Email">
      </div>

      <div>
        <textarea name="comments" placeholder="Your Comments">
</textarea>
      </div>

      <div>
        <input type="submit" value="Add Comments">
      </div>
    </form>
    {{range .Comments}}
    <div class="comment">
      <div>
        Comment by {{.Name}} ({{.Email}})
      </div>
      {{.CommentText}}
      <div class="comment_edit">
        <h2>Edit</h2>

        <form onsubmit="return putComment(this);">
          <input type="hidden" class="edit_id" value="{{.Id}}">
          <input type="text" name="name" class="edit_name" placeholder="Your Name" value="{{.Name}}">
          <input type="text" name="email" class="edit_email" placeholder="Your Email" value="{{.Email}}">
          <textarea class="edit_comments" name="comments">{{.CommentText}}</textarea>
          <input type="submit" value="Edit">
        </form>
      </div>
    </div>
    {{end}}
  </div>
</body>
</html>
